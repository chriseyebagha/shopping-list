<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Shopping List</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', sans-serif;
    background-color: #f4f6f8;
    color: #1a1d24;
    padding: 24px 16px 72px;
    min-height: 100vh;
  }

  .header {
    max-width: 660px;
    margin: 0 auto 20px;
    text-align: center;
  }
  .header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    color: #1a1d24;
    line-height: 1.3;
    margin-bottom: 6px;
  }
  .header h1 .highlight { color: #d4850f; }
  .header p {
    font-size: 0.88rem;
    color: #5a6070;
    line-height: 1.5;
  }

  /* Add item section */
  .add-item-section {
    max-width: 660px;
    margin: 0 auto 16px;
    background: #ffffff;
    border: 2px solid #d4850f;
    border-radius: 12px;
    padding: 16px;
  }
  .add-item-section h3 {
    font-size: 0.9rem;
    font-weight: 600;
    color: #1a1d24;
    margin-bottom: 12px;
  }
  .add-item-form {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .add-item-row {
    display: flex;
    gap: 8px;
  }
  .add-item-form input,
  .add-item-form select {
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    padding: 10px 12px;
    border: 1px solid #e4e7ed;
    border-radius: 8px;
    background: #f9fafb;
  }
  .add-item-form input {
    flex: 1;
  }
  .add-item-form select {
    min-width: 140px;
  }
  .add-item-form input:focus,
  .add-item-form select:focus {
    outline: none;
    border-color: #d4850f;
    background: #fff;
  }
  .add-item-form button {
    font-family: 'Inter', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    padding: 10px 20px;
    background: #d4850f;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    white-space: nowrap;
  }
  .add-item-form button:active {
    transform: scale(0.98);
  }

  /* Active list section */
  .active-list {
    max-width: 660px;
    margin: 0 auto 32px;
  }
  .active-list-empty {
    background: #ffffff;
    border: 1px solid #e4e7ed;
    border-radius: 12px;
    padding: 40px 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #9a9fad;
    font-size: 0.88rem;
    font-style: italic;
    text-align: center;
  }

  .store-group {
    background: #ffffff;
    border: 1px solid #e4e7ed;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
  }
  .store-group-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #f0f2f5;
  }
  .store-group-icon {
    width: 36px;
    height: 36px;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
  }
  .store-group-name {
    font-size: 1rem;
    font-weight: 700;
    color: #1a1d24;
  }

  .divider {
    max-width: 660px;
    margin: 40px auto;
    text-align: center;
    position: relative;
  }
  .divider::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    height: 1px;
    background: #e0e3e8;
  }
  .divider span {
    position: relative;
    background: #f4f6f8;
    padding: 0 16px;
    font-size: 0.82rem;
    font-weight: 600;
    color: #7a8290;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .store-section {
    max-width: 660px;
    margin: 0 auto 28px;
  }
  .store-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e0e3e8;
  }
  .store-icon {
    width: 42px;
    height: 42px;
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    flex-shrink: 0;
  }
  .store-icon.pending { background: #ef4444; }
  .store-icon.tjmaxx { background: #991b1b; }
  .store-icon.costco { background: #003087; }
  .store-icon.tj { background: #c1272d; }
  .store-icon.home { background: #f97316; }
  .store-icon.tools { background: #57534e; }
  
  .store-header h2 {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1a1d24;
  }
  .store-header .item-count {
    font-size: 0.78rem;
    color: #7a8290;
    margin-top: 2px;
  }

  .item {
    background: #ffffff;
    border: 1px solid #e4e7ed;
    border-radius: 12px;
    padding: 14px 14px;
    margin-bottom: 8px;
    display: flex;
    gap: 12px;
    align-items: center;
    transition: border-color 0.15s;
  }
  .item:hover { border-color: #c0c4cc; }

  .item.active-item {
    background: #fffbf0;
    border-color: #f0d88a;
  }

  /* Hide default checkbox */
  .item input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
  }

  /* Custom checkbox */
  .checkmark {
    width: 22px;
    height: 22px;
    border-radius: 6px;
    border: 2px solid #c8ccd5;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    transition: all 0.2s;
  }

  .checkmark svg {
    opacity: 0;
    transition: opacity 0.2s;
  }

  .item input[type="checkbox"]:checked ~ .checkmark {
    background: #22c55e;
    border-color: #22c55e;
  }

  .item input[type="checkbox"]:checked ~ .checkmark svg {
    opacity: 1;
  }

  .item input[type="checkbox"]:checked ~ .item-label {
    text-decoration: line-through;
    color: #9a9fad;
  }

  .item input[type="checkbox"]:checked ~ .item-label,
  .item input[type="checkbox"]:checked ~ .checkmark {
    opacity: 0.4;
  }

  .item-label {
    font-size: 0.95rem;
    font-weight: 500;
    color: #1a1d24;
    line-height: 1.4;
    flex: 1;
    cursor: pointer;
    -webkit-user-select: none;
    user-select: none;
  }

  .item label {
    display: flex;
    gap: 12px;
    align-items: center;
    cursor: pointer;
    flex: 1;
  }

  .delete-btn {
    background: #fee;
    border: 1px solid #fcc;
    color: #c00;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    flex-shrink: 0;
  }
  .delete-btn:active {
    transform: scale(0.95);
  }

  .action-buttons {
    max-width: 660px;
    margin: 20px auto 0;
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .action-buttons button {
    background: #ffffff;
    border: 1px solid #e4e7ed;
    border-radius: 10px;
    padding: 12px 24px;
    font-family: 'Inter', sans-serif;
    font-size: 0.88rem;
    font-weight: 600;
    color: #5a6070;
    cursor: pointer;
  }
  .action-buttons button.danger {
    color: #ef4444;
  }
  .action-buttons button:active {
    transform: scale(0.98);
  }

  .suggestion-item {
    opacity: 0.85;
  }
  .suggestion-item:hover {
    opacity: 1;
  }
</style>
<script>
// --- INITIAL DATA SEEDING ---
// This list is used only if the user has NO suggestion history.
// It gives them a good starting point.
const INITIAL_SEED_DATA = [
  // Apartment Essentials
  { name: 'Plunger ðŸª ', store: 'General', count: 10 },
  { name: 'Toilet Brush', store: 'General', count: 9 },
  { name: 'Shower Curtain & Liner', store: 'General', count: 9 },
  { name: 'First Aid Kit ðŸ©¹', store: 'General', count: 8 },
  { name: 'Flashlight & Batteries ðŸ”¦', store: 'General', count: 8 },
  { name: 'Extension Cords / Power Strips', store: 'General', count: 8 },
  { name: 'Basic Tool Kit (Hammer, Screwdrivers)', store: 'Hardware Store', count: 8 },
  { name: 'Vacuum or Broom/Dustpan', store: 'Target', count: 8 },
  { name: 'Mop / Swiffer', store: 'Target', count: 8 },
  { name: 'All-Purpose Cleaner', store: 'Target', count: 10 },

  // TJ Maxx
  { name: 'Plates', store: 'TJ Maxx', count: 5 },
  { name: 'Spoons', store: 'TJ Maxx', count: 5 },
  { name: 'Wine glass', store: 'TJ Maxx', count: 3 },
  { name: 'Trash bags', store: 'TJ Maxx', count: 10 },
  { name: 'Trash bin', store: 'TJ Maxx', count: 2 },
  { name: 'Cups', store: 'TJ Maxx', count: 5 },
  { name: 'Rain Jacket', store: 'TJ Maxx', count: 1 },
  { name: "Chef's Knife ðŸ”ª", store: 'TJ Maxx', count: 6 },
  { name: 'Cutting Board', store: 'TJ Maxx', count: 6 },
  { name: 'Can opener', store: 'TJ Maxx', count: 4 },
  { name: 'Wine opener', store: 'TJ Maxx', count: 2 },
  { name: 'Oven mitts', store: 'TJ Maxx', count: 3 },
  { name: 'Tupperware', store: 'TJ Maxx', count: 8 },
  { name: 'Bath mat', store: 'TJ Maxx', count: 2 },
  { name: 'Hand towels', store: 'TJ Maxx', count: 5 },
  { name: 'Bathing sponge', store: 'TJ Maxx', count: 6 },
  { name: 'Laundry hamper', store: 'TJ Maxx', count: 2 },
  { name: 'Hangers (Pack)', store: 'TJ Maxx', count: 4 },

  // Costco
  { name: 'Toilet paper', store: 'Costco', count: 20 },
  { name: 'Paper towels', store: 'Costco', count: 18 },
  { name: 'Kitchen napkin', store: 'Costco', count: 12 },
  { name: 'Coco water', store: 'Costco', count: 10 },
  { name: 'Celsius', store: 'Costco', count: 15 },
  { name: 'Laundry detergent', store: 'Costco', count: 12 },
  { name: 'Dish Soap & Sponges', store: 'Costco', count: 14 },
  { name: 'Kirkland Grilled Chicken Breast Skewers', store: 'Costco', count: 15 },
  { name: 'Kirkland Wild Alaskan Sockeye Salmon', store: 'Costco', count: 12 },
  { name: 'Kahiki Chicken Rice Bowls â€” Teriyaki', store: 'Costco', count: 8 },
  { name: 'Kirkland Rotisserie Chicken', store: 'Costco', count: 25 },
  { name: 'Bibigo Beef Pho Steamed Dumplings', store: 'Costco', count: 10 },
  { name: 'Kirkland Boneless Chicken Breasts (frozen)', store: 'Costco', count: 15 },

  // Trader Joe's
  { name: 'Eggs', store: "Trader Joe's", count: 30 },
  { name: 'Butter', store: "Trader Joe's", count: 15 },
  { name: 'Olive oil', store: "Trader Joe's", count: 8 },
  { name: 'Salt', store: "Trader Joe's", count: 5 },
  { name: 'Pepper', store: "Trader Joe's", count: 5 },
  { name: 'Branzino Fish', store: "Trader Joe's", count: 10 },
  { name: 'Tikka Masala', store: "Trader Joe's", count: 12 },
  { name: 'Argentinian Red Shrimp', store: "Trader Joe's", count: 10 },
  { name: 'Wild Raw Argentinian Red Shrimp (1 lb)', store: "Trader Joe's", count: 10 },
  { name: 'Pulled Chicken Salsa Verde', store: "Trader Joe's", count: 12 },
  { name: 'Pre-Cooked Grilled Chicken Strips', store: "Trader Joe's", count: 15 },
  { name: 'Bacon Cheddar Egg Bites', store: "Trader Joe's", count: 14 }
];

// --- APP STATE ---
let activeList = [];
let suggestionDB = {}; // format: { "Item Name": { store: "Costco", count: 5, lastUsed: 123456789 } }

// Store icon mapping
const storeIcons = {
  'TJ Maxx': { emoji: 'ðŸ¬', color: '#991b1b' },
  'Costco': { emoji: 'ðŸ›’', color: '#003087' },
  "Trader Joe's": { emoji: 'ðŸ›’', color: '#c1272d' },
  'Target': { emoji: 'ðŸŽ¯', color: '#cc0000' },
  'Whole Foods': { emoji: 'ðŸ¥¬', color: '#00674f' },
  'Safeway': { emoji: 'ðŸ›’', color: '#e31837' },
  'Amazon': { emoji: 'ðŸ“¦', color: '#ff9900' },
  'Home Depot': { emoji: 'ðŸ”¨', color: '#f96302' },
  'IKEA': { emoji: 'ðŸª‘', color: '#0058a3' },
  'Hardware Store': { emoji: 'ðŸ› ï¸', color: '#57534e' },
  'General': { emoji: 'ðŸ ', color: '#f97316' }
};

function getStoreIcon(storeName) {
  if (storeIcons[storeName]) return storeIcons[storeName];
  return { emoji: 'ðŸ›’', color: '#6b7280' };
}

// --- PERSISTENCE ---
function saveAppState() {
  localStorage.setItem('activeShoppingList', JSON.stringify(activeList));
  localStorage.setItem('shoppingListSuggestionsDB', JSON.stringify(suggestionDB));
  localStorage.setItem('storeIcons', JSON.stringify(storeIcons));
}

function loadAppState() {
  // Load Active List
  const savedActive = localStorage.getItem('activeShoppingList');
  if (savedActive) activeList = JSON.parse(savedActive);

  // Load Icons
  const savedIcons = localStorage.getItem('storeIcons');
  if (savedIcons) Object.assign(storeIcons, JSON.parse(savedIcons));

  // Load Suggestions
  const savedDB = localStorage.getItem('shoppingListSuggestionsDB');
  if (savedDB) {
    suggestionDB = JSON.parse(savedDB);
  } else {
    // SEED DB if empty
    seedDatabase();
  }
}

function seedDatabase() {
  const now = Date.now();
  INITIAL_SEED_DATA.forEach(item => {
    suggestionDB[item.name] = {
      store: item.store,
      count: item.count,
      lastUsed: now
    };
  });
  saveAppState();
}

// --- LOGIC ---

function addItem(itemName, storeName) {
  if (!itemName.trim() || !storeName.trim()) return;
  itemName = itemName.trim();
  storeName = storeName.trim();

  // 1. Add to Active List
  activeList.push({ name: itemName, store: storeName, checked: false });

  // 2. Update Knowledge Base (Smart Learning)
  updateItemStats(itemName, storeName);

  saveAppState();
  renderAll();
}

function updateItemStats(itemName, storeName) {
  if (!suggestionDB[itemName]) {
    // New item learned!
    suggestionDB[itemName] = {
      store: storeName,
      count: 1,
      lastUsed: Date.now()
    };
  } else {
    // Existing item reinforced
    suggestionDB[itemName].count++;
    suggestionDB[itemName].lastUsed = Date.now();
    // Update store if they changed it, or keep old? Let's update it to latest preference.
    suggestionDB[itemName].store = storeName;
  }
}

function removeItem(index) {
  activeList.splice(index, 1);
  saveAppState();
  renderActiveList(); // No need to re-render suggestions
}

function toggleItem(index) {
  activeList[index].checked = !activeList[index].checked;
  saveAppState();
  // Optional: Checking an item could also boost its stats? 
  // For now, only ADDING boosts stats to keep it simple.
}

function clearChecked() {
  activeList = activeList.filter(item => !item.checked);
  saveAppState();
  renderActiveList();
}

function clearAll() {
  if (confirm('Clear your entire shopping list?')) {
    activeList = [];
    saveAppState();
    renderActiveList();
  }
}

// --- RENDERING ---

function renderAll() {
  renderActiveList();
  renderSuggestions();
}

function renderActiveList() {
  const container = document.getElementById('activeListContainer');
  
  if (activeList.length === 0) {
    container.innerHTML = '<div class="active-list-empty">Your list is empty. Add items above to get started.</div>';
    return;
  }
  
  // Group items by store
  const byStore = {};
  activeList.forEach((item, idx) => {
    if (!byStore[item.store]) byStore[item.store] = [];
    byStore[item.store].push({ ...item, index: idx });
  });
  
  let html = '<div class="active-list">';
  Object.keys(byStore).sort().forEach(storeName => {
    const icon = getStoreIcon(storeName);
    html += `
      <div class="store-group">
        <div class="store-group-header">
          <div class="store-group-icon" style="background: ${icon.color}">${icon.emoji}</div>
          <div class="store-group-name">${storeName}</div>
        </div>
    `;
    
    byStore[storeName].forEach(item => {
      html += `
        <div class="item active-item">
          <label>
            <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleItem(${item.index})"/>
            <div class="checkmark"><svg viewBox="0 0 12 12" fill="none" stroke="#fff" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M2 6.5L5 9.5L10 3"/></svg></div>
            <span class="item-label">${item.name}</span>
          </label>
          <button class="delete-btn" onclick="removeItem(${item.index})">Delete</button>
        </div>
      `;
    });
    html += '</div>';
  });
  html += '</div>';
  
  container.innerHTML = html;
}

function renderSuggestions() {
  const container = document.getElementById('suggestionsContainer');
  
  // 1. Check if items are already in active list (to hide them)
  const activeNames = new Set(activeList.map(i => i.name));

  // 2. Convert DB to Array
  let candidates = Object.entries(suggestionDB).map(([name, data]) => ({
    name: name,
    ...data
  }));

  // 3. Filter out things already in the list
  candidates = candidates.filter(item => !activeNames.has(item.name));

  // 4. SORT ALGORITHM
  // Priority 1: High Count (Frequency)
  // Priority 2: Recency (Last Used)
  candidates.sort((a, b) => {
    if (b.count !== a.count) return b.count - a.count;
    return b.lastUsed - a.lastUsed;
  });

  // 5. Limit to Top 50
  const topSuggestions = candidates.slice(0, 50);

  if (topSuggestions.length === 0) {
    container.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">No suggestions available yet.</div>';
    return;
  }

  // 6. Group by Store
  const byStore = {};
  topSuggestions.forEach(item => {
    if (!byStore[item.store]) byStore[item.store] = [];
    byStore[item.store].push(item);
  });

  // 7. Render
  let html = '';
  Object.keys(byStore).sort().forEach(storeName => {
    const icon = getStoreIcon(storeName);
    html += `
      <div class="store-section">
        <div class="store-header">
          <div class="store-icon" style="background: ${icon.color}">${icon.emoji}</div>
          <div>
            <h2>${storeName}</h2>
            <div class="item-count">Suggested</div>
          </div>
        </div>
    `;
    
    byStore[storeName].forEach(item => {
      // Escape single quotes for the onclick handler
      const escapedName = item.name.replace(/'/g, "\\'");
      const escapedStore = item.store.replace(/'/g, "\\'");
      
      html += `
        <div class="item suggestion-item" onclick="addSuggestion('${escapedName}', '${escapedStore}')">
          <span class="item-label" style="cursor: pointer;">${item.name}</span>
        </div>
      `;
    });
    html += '</div>';
  });

  container.innerHTML = html;
}

// --- EVENT HANDLERS ---

function addSuggestion(name, store) {
  addItem(name, store);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.addEventListener('DOMContentLoaded', function() {
  loadAppState();
  renderAll();
  
  const addForm = document.getElementById('addItemForm');
  const itemInput = document.getElementById('newItemInput');
  const storeSelect = document.getElementById('storeSelect');
  
  addForm.addEventListener('submit', function(e) {
    e.preventDefault();
    addItem(itemInput.value, storeSelect.value);
    itemInput.value = '';
    itemInput.focus();
  });
  
  // Custom store handler
  storeSelect.addEventListener('change', function() {
    if (this.value === 'custom') {
      const customStore = prompt('Enter store name:');
      if (customStore && customStore.trim()) {
        const option = document.createElement('option');
        option.value = customStore.trim();
        option.textContent = customStore.trim();
        option.selected = true;
        this.insertBefore(option, this.querySelector('option[value="custom"]'));
        
        // Save new store icon color if needed (random/default for now)
        if (!storeIcons[customStore.trim()]) {
          storeIcons[customStore.trim()] = { emoji: 'ðŸ›ï¸', color: '#6b7280' };
        }
      } else {
        this.value = '';
      }
    }
  });

  // Touch support for mobile suggestions
  setTimeout(() => {
    const container = document.getElementById('suggestionsContainer');
    container.addEventListener('touchend', function(e) {
      // Delegate touch event
      const itemRow = e.target.closest('.suggestion-item');
      if (itemRow) {
        e.preventDefault();
        // Trigger the click logic
        itemRow.click();
      }
    });
  }, 500);
});
</script>
</head>
<body>

<div class="header">
  <h1>Shopping <span class="highlight">List</span></h1>
  <p>Add items or pick from your most frequent purchases below</p>
</div>

<!-- ADD ITEM SECTION -->
<div class="add-item-section">
  <h3>âž• Add Item</h3>
  <form id="addItemForm" class="add-item-form">
    <div class="add-item-row">
      <input type="text" id="newItemInput" placeholder="Item name..." required/>
      <select id="storeSelect" required>
        <option value="">Store...</option>
        <option value="TJ Maxx">TJ Maxx</option>
        <option value="Costco">Costco</option>
        <option value="Trader Joe's">Trader Joe's</option>
        <option value="Target">Target</option>
        <option value="Home Depot">Home Depot</option>
        <option value="Hardware Store">Hardware Store</option>
        <option value="General">General</option>
        <option value="custom">+ New Store...</option>
      </select>
    </div>
    <button type="submit">Add to List</button>
  </form>
</div>

<!-- ACTIVE LIST -->
<div id="activeListContainer">
  <!-- Filled by Javascript -->
</div>

<!-- ACTION BUTTONS -->
<div class="action-buttons">
  <button onclick="clearChecked()">Remove Checked Items</button>
  <button class="danger" onclick="clearAll()">Clear Entire List</button>
</div>

<!-- DIVIDER -->
<div class="divider">
  <span>Suggested Items (Top 50)</span>
</div>

<!-- SUGGESTIONS CONTAINER -->
<!-- Now fully dynamic -->
<div id="suggestionsContainer">
  <!-- Filled by Javascript -->
</div>

</body>
</html>